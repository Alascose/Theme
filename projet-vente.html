<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion de Transactions</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .active {
          background-color: rgb(2, 31, 85); /* Couleur de fond lorsque le bouton est actif */
        }
   </style>
</head>
<body>
    <div class="container-fluid d-flex m-0 p-0 w-100">
    <div class="sidebar  ms-2 my-2" style="background-color: rgb(5, 83, 156); width: 230px; 
            border-top-left-radius: 10px; border-bottom-left-radius: 10px; height: 600px;">
      <ul class="list-unstyled ms-3 mt-3">
          <li class="d-flex mt-5 my-4 indexe">
              <span class="mx-2 mt-2"><img src="images/home_16px.png" alt=""></span>
              <a href="projet-index.html" class="text-white mt-1">Accueil</a>
          </li>
          <li class="d-flex mt-2 indexe">
              <span class="mx-2 mt-2"><img src="images/scan_stock_16px.png" alt=""></span>
              <a href="projet-stocks.html" class="text-white mt-1">Stocks</a>
          </li>
          <li class="my-4 d-flex indexe">
              <span class="mx-2 mt-2"><img src="images/sell_16px.png" alt="" class=""></span>
              <a href="projet-vente.html" class="text-white mt-1">Ventes</a>
          </li>
          <li class="my-4 d-flex indexe">
            <span class="mx-2 mt-2"><img src="images/reception_16px.png" alt="" class=""></span>
            <a href="projet-clients.html" class="text-white mt-1">Clients</a>
        </li>
          <li class="my-4 d-flex indexe">
            <span class="mx-2 mt-2"><img src="images/online_money_transfer_16px.png" alt="" class=""></span>
            <a href="projet-finance.html" class="text-white mt-1">Finances</a>
        </li>
          <li class="my-4 d-flex indexe">
              <span class="mx-2 mt-2"><img src="images/user_groups_16px.png" alt="" class=""></span>
              <a href="projet-employeur.html" class="text-white mt-1">Employers</a>
          </li>
          <li class="my-4 d-flex indexe">
            <span class="mx-2 mt-2"><img src="images/buy_16px.png" alt="" class=""></span>
            <a href="projet-fournisseur.html" class="text-white mt-1">Fournisseur</a>
        </li>
          <li class="my-4 d-flex indexe">
              <span class="mx-2 mt-2"><img src="images/settings_16px.png" alt="" class=""></span>
              <a href="#" class="text-white mt-1">paramètre</a>
          </li>
      </ul>
    </div>
  <div class="flex-grow-1 me-2 my-2" style="background-color:rgba(214, 210, 220, 0.539);
      border-top-right-radius: 10px; border-bottom-right-radius: 10px;">
    <header class="shadow-lg py-2 mx-3 mt-3">
        <h2 class="text-center">Gestion de Transactions</h2>
    </header>
    <ul class="nav nav-tabs my-4 ms-3" id="onglets" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="vente-tab" data-bs-toggle="tab" data-bs-target="#vente" type="button" role="tab" aria-controls="vente" aria-selected="true">Vente</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="facture-tab" data-bs-toggle="tab" data-bs-target="#facture" type="button" role="tab" aria-controls="facture" aria-selected="false">Facture</button>
        </li>
    </ul>
    <!-- Contenu des onglets -->
    <div class="tab-content" id="onglets-contenu">
        <!-- Onglet Ventes -->
        <div class="tab-pane fade show active my-2" id="vente" role="tabpanel" aria-labelledby="vente-tab">
            <div class="text-end mx-2">
                <!-- Bouton Ajouter Ventes -->
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#ajouterVenteModal">Ajouter Ventes</button>
            </div>
            <h5 class="mt-3 text-center">Liste des Ventes</h5>
            <table class="table table-striped mt-3">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nom &amp; Prenom Client</th>
                        <th>Telephone</th>
                        <th>Email</th>
                        <th>Produit</th>
                        <th>Quantité</th>
                        <th>Montant Total</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="table-ventes">
                    <!-- Les ventes ajoutées seront affichées ici -->
                </tbody>
            </table>
        </div>

        <!-- Onglet Facture -->
        <div class="tab-pane fade" id="facture" role="tabpanel" aria-labelledby="facture-tab">
            <h3 class="mt-3">Facture</h3>
            <table class="table table-bordered mt-3">
                <thead>
                    <tr>
                        
                    </tr>
                </thead>
                <tbody id="table-factures">
                    <!-- Les factures seront affichées ici -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modale Ajouter Ventes -->
    <div class="modal fade" id="ajouterVenteModal" tabindex="-1" aria-labelledby="ajouterVenteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ajouterVenteModalLabel">Ajouter Vente</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="form-vente">
                        <div class="mb-3">
                            <label for="nomClient" class="form-label">Nom & Prenom</label>
                            <input type="text" class="form-control" id="nomClient" required>
                        </div>
                        <div class="mb-3">
                            <label for="telClient" class="form-label">Telephone</label>
                            <input type="tel" class="form-control" id="telClient" required>
                        </div>
                        <div class="mb-3">
                            <label for="emailClient" class="form-label">Email</label>
                            <input type="email" class="form-control" id="emailClient" required>
                        </div>
                        <div class="mb-3">
                            <label for="produitVente" class="form-label">Produit</label>
                            <select class="form-select" id="produitVente" required>
                                <option value="">Sélectionnez...</option>
                                <option value="Television">Television</option>
                                <option value="Imprimante">Imprimante</option>
                                <option value="Ordinateur portable">Ordinateur portable</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="quantiteVente" class="form-label">Quantité</label>
                            <input type="number" class="form-control" id="quantiteVente" required>
                        </div>
                        <div class="mb-3">
                            <label for="montantVente" class="form-label">Montant Total(CFA)</label>
                            <input type="number" class="form-control" id="montantVente" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="dateVente" class="form-label">Date</label>
                            <input type="date" class="form-control" id="dateVente" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Ajouter Vente</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modale Voir Facture -->
    <div class="modal fade" id="voirFactureModal" tabindex="-1" aria-labelledby="voirFactureModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="voirFactureModalLabel">Facture</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="factureContent">
                    <!-- Contenu de la facture générée sera affiché ici -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de modification pour les ventes -->
    <div class="modal fade" id="modifierVenteModal" tabindex="-1" aria-labelledby="modifierVenteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modifierVenteModalLabel">Modifier Vente</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="form-modifier-vente">
                        <div class="mb-3">
                            <label for="nomClientModifier" class="form-label">Nom & Prenom</label>
                            <input type="text" class="form-control" id="nomClientModifier" required>
                        </div>
                        <div class="mb-3">
                            <label for="telClientModifier" class="form-label">Telephone</label>
                            <input type="tel" class="form-control" id="telClientModifier" required>
                        </div>
                        <div class="mb-3">
                            <label for="emailClientModifier" class="form-label">Email</label>
                            <input type="email" class="form-control" id="emailClientModifier" required>
                        </div>
                        <div class="mb-3">
                            <label for="produitVenteModifier" class="form-label">Produit</label>
                            <select class="form-select" id="produitVenteModifier" required>
                                <option value="">Sélectionnez...</option>
                                <option value="Television">Television</option>
                                <option value="Imprimante">Imprimante</option>
                                <option value="Ordinateur portable">Ordinateur portable</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="quantiteVenteModifier" class="form-label">Quantité</label>
                            <input type="number" class="form-control" id="quantiteVenteModifier" required>
                        </div>
                        <div class="mb-3">
                            <label for="montantVenteModifier" class="form-label">Montant Total(CFA)</label>
                            <input type="number" class="form-control" id="montantVenteModifier" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="dateVenteModifier" class="form-label">Date</label>
                            <input type="date" class="form-control" id="dateVenteModifier" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Modifier Vente</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de suppression -->
    <div class="modal fade" id="supprimerVenteModal" tabindex="-1" aria-labelledby="supprimerVenteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="supprimerVenteModalLabel">Confirmation de suppression</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Êtes-vous sûr de vouloir supprimer cette vente ?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-danger" id="confirmerSuppressionVente">Supprimer</button>
                </div>
            </div>
        </div>
    </div>
  </div>
</div>

    <script src="css/bootstrap.bundle.min.js"></script>
    <script src="script.js"></script>
    <script src="css/event.js"></script>
    <script>
        let ventes = JSON.parse(localStorage.getItem('ventes')) || [];
        let factures = JSON.parse(localStorage.getItem('factures')) || [];
        

// Déclaration d'un objet pour associer chaque produit à son prix unitaire pour les ventes
const prixUnitaires = {
      "Television": 100000, // Prix unitaire pour le produit 1 en CFA
      "Imprimante": 150000, // Prix unitaire pour le produit 2 en CFA
      "Ordinateur portable": 200000, // Prix unitaire pour le produit 2 en CFA
      // Ajoutez d'autres produits avec leurs prix unitaires ici
    };

    // Fonction pour calculer le montant total en fonction du produit et de la quantité
    function calculerMontantTotal(produitVente, quantiteVente) {
      const prixUnitaire = prixUnitaires[produitVente];
      return prixUnitaire * quantiteVente;
    }

    $(document).ready(function() {
      // Écouteur d'événement pour le changement de quantité
      $('#quantiteVente').on('input', function() {
        const produitVente = $('#produitVente').val();
        const quantiteVente = $(this).val();
        const montantTotal = calculerMontantTotal(produitVente, quantiteVente);
        $('#montantVente').val(montantTotal);
      });
    });

        // Afficher les ventes
        function afficherVentes() {
            const tableBody = document.getElementById('table-ventes');
            tableBody.innerHTML = '';
            ventes.forEach(vente => {
                const tr = document.createElement('tr');
                tr.setAttribute('data-id', vente.id);
                tr.innerHTML = `
                    <td>${vente.id}</td>
                    <td>${vente.nomClient}</td>
                    <td>${vente.telClient}</td>
                    <td>${vente.emailClient}</td>
                    <td>${vente.produitVente}</td>
                    <td>${vente.quantiteVente}</td>
                    <td>${vente.montantVente}</td>
                    <td>${vente.dateVente}</td>
                    <td>
                        <button class="btn btn-outline-warning btn-sm my-1" onclick="modifierEntry(${vente.id}, 'vente')">Modifier</button>
                        <button class="btn btn-outline-danger btn-sm" onclick="ouvrirModalSuppression(${vente.id}, 'vente')">Supprimer</button>
                    </td>
                `;
                tableBody.appendChild(tr);
            });
        }

        // Fonction pour ouvrir la modale de modification avec les données de la vente à modifier
        function modifierEntry(id, type) {
            if (type === 'vente') {
                const vente = ventes.find(v => v.id === id);
                if (vente) {
                    document.getElementById('nomClientModifier').value = vente.nomClient;
                    document.getElementById('telClientModifier').value = vente.telClient;
                    document.getElementById('emailClientModifier').value = vente.emailClient;
                    document.getElementById('produitVenteModifier').value = vente.produitVente;
                    document.getElementById('quantiteVenteModifier').value = vente.quantiteVente;
                    document.getElementById('montantVenteModifier').value = vente.montantVente;
                    document.getElementById('dateVenteModifier').value = vente.dateVente;
                    document.getElementById('montantVenteModifier').value = '';
                    document.getElementById('form-modifier-vente').onsubmit = function(event) {
                        event.preventDefault();
                        vente.nomClient = document.getElementById('nomClientModifier').value;
                        vente.telClient = document.getElementById('telClientModifier').value;
                        vente.emailClient = document.getElementById('emailClientModifier').value;
                        vente.produitVente = document.getElementById('produitVenteModifier').value;
                        vente.quantiteVente = document.getElementById('quantiteVenteModifier').value;
                        vente.montantVente = document.getElementById('montantVenteModifier').value;
                        vente.dateVente = document.getElementById('dateVenteModifier').value;
                        localStorage.setItem('ventes', JSON.stringify(ventes));
                        afficherVentes();
                        const modal = bootstrap.Modal.getInstance(document.getElementById('modifierVenteModal'));
                        modal.hide();
                    };
                    const modal = new bootstrap.Modal(document.getElementById('modifierVenteModal'));
                    modal.show();
                }
            }
        }

        // Fonction pour générer une facture
        function genererFacture(vente) {
            const facture = {
                id: vente.id,
                nomClient: vente.nomClient,
                telClient: vente.telClient,
                emailClient: vente.emailClient,
                produitVente: vente.produitVente,
                quantiteVente: vente.quantiteVente,
                montantVente: vente.montantVente,
                dateVente: vente.dateVente,
            };
            factures.push(facture);
            localStorage.setItem('factures', JSON.stringify(factures));
            afficherFactures();
        }

        // Afficher les factures
        function afficherFactures(vente) {
            const tableBody = document.getElementById('table-factures');
            tableBody.innerHTML = '';
            factures.forEach(facture => {
                const tr = document.createElement('tr');
                tr.setAttribute('data-id', facture.id);
                tr.innerHTML = `
                    <td>${facture.id}</td>
                    <td>${facture.nomClient}</td>
                    <td>${facture.telClient}</td>
                    <td>${facture.emailClient}</td>
                    <td>${facture.produitVente}</td>
                    <td>${facture.quantiteVente}</td>
                    <td>${facture.montantVente}</td>
                    <td>${facture.dateVente}</td>
                    <td>
                        <button class="btn btn-outline-info btn-sm" onclick="voirFacture(${facture.id})">Voir</button>
                        <button class="btn btn-outline-danger btn-sm" onclick="ouvrirModalSuppression(${facture.id}, 'facture')">Supprimer</button>
                    </td>
                `;
                tableBody.appendChild(tr);
                localStorage.setItem('factures', JSON.stringify(factures));
            });
        }

        // Fonction pour afficher les détails de la facture dans une modale
        function voirFacture(id) {
            const facture = factures.find(f => f.id === id);
            if (facture) {
                const factureContent = document.getElementById('factureContent');
                factureContent.innerHTML = `
                    <p class="text-center"><strong>N° Facture:</strong> ${facture.id}</p>
                    <p><strong>Nom & Prenom:</strong> ${facture.nomClient}</p>
                    <p><strong>Telephone:</strong> ${facture.telClient}</p>
                    <p><strong>Email:</strong> ${facture.emailClient}</p>
                    <p><strong>Produit:</strong> ${facture.produitVente}</p>
                    <p><strong>Quantité:</strong> ${facture.quantiteVente}</p>
                    <p><strong>Montant Total (CFA):</strong> ${facture.montantVente}</p>
                    <p><strong>Date:</strong> ${facture.dateVente}</p>
                `;
                const modal = new bootstrap.Modal(document.getElementById('voirFactureModal'));
                modal.show();
            }
        }

        // Fonction pour ouvrir la modale de suppression pour les ventes et factures
        function ouvrirModalSuppression(id, type) {
            if (type === 'vente') {
                document.getElementById('confirmerSuppressionVente').onclick = function() {
                    ventes = ventes.filter(v => v.id !== id);
                    localStorage.setItem('ventes', JSON.stringify(ventes));
                    afficherVentes();
                    const modal = bootstrap.Modal.getInstance(document.getElementById('supprimerVenteModal'));
                    modal.hide();
                };
                const modal = new bootstrap.Modal(document.getElementById('supprimerVenteModal'));
                modal.show();
            } else if (type === 'facture') {
                document.getElementById('confirmerSuppressionVente').onclick = function() {
                    factures = factures.filter(f => f.id !== id);
                    localStorage.setItem('factures', JSON.stringify(factures));
                    afficherFactures();
                    const modal = bootstrap.Modal.getInstance(document.getElementById('supprimerVenteModal'));
                    modal.hide();
                };
                const modal = new bootstrap.Modal(document.getElementById('supprimerVenteModal'));
                modal.show();
            }
        }

        // Appeler la génération de facture après l'ajout d'une vente
        document.getElementById('form-vente').onsubmit = function(event) {
            event.preventDefault();

            const newVente = {
                id: Date.now(),
                nomClient: document.getElementById('nomClient').value,
                telClient: document.getElementById('telClient').value,
                emailClient: document.getElementById('emailClient').value,
                produitVente: document.getElementById('produitVente').value,
                quantiteVente: document.getElementById('quantiteVente').value,
                montantVente: document.getElementById('montantVente').value,
                dateVente: document.getElementById('dateVente').value
            };

            ventes.push(newVente);
            localStorage.setItem('ventes', JSON.stringify(ventes));
            afficherVentes();
            genererFacture(newVente);
            afficherFactures();

            // Réinitialiser le formulaire
            document.getElementById('form-vente').reset();
            const modal = bootstrap.Modal.getInstance(document.getElementById('ajouterVenteModal'));
            modal.hide();
        };

        afficherVentes();
        afficherFactures();
    </script>
</body>
</html>
